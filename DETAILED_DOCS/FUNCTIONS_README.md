# Подробное описание функций страниц и скриптов (TVCompanyX)

Этот документ перечисляет основные страницы, компоненты и скрипты проекта и описывает, какие функции они выполняют. Это начальный подробный справочник — при желании его можно расширить автоматически извлекая JSDoc/комментарии.

---

## Страницы (src/pages)

### `/_app.tsx`
- Оборачивает приложение Redux `Provider` и добавляет глобальные теги `Head`.
- Ждёт монтирования клиента (предотвращает SSR/hydration mismatch).

### `/auth.tsx`
- Страница аутентификации с переключением между формами входа и регистрации.
- Использует компоненты `LoginForm` и `RegisterForm`.
- При успешной аутентификации перенаправляет пользователя в раздел по роли.

### `/index.tsx`
- Главная публичная страница (короткое описание и ссылки). Используется как маршрут по умолчанию.

### `/customer/*`, `/agent/*`, `/commercial/*`, `/accountant/*`, `/admin/*`, `/director/*`
- Релятивные разделы для ролей: каждая папка содержит страницы функционала, специфичного для роли.
- Примеры страниц: `applications.tsx`, `chat.tsx`, `reports.tsx`, `profile.tsx`.

### `/api/*`
- Серверные Next.js API-роуты. Основные файлы:
  - `api/auth/login.ts` — логика аутентификации (POST: email, password). Возвращает JWT и пользовательские данные.
  - `api/auth/register.ts` — регистрация нового пользователя, хеширование пароля, создание записи в БД.
  - `api/ads/*`, `api/shows/*`, `api/schedule/*` — API для заявок, шоу и расписания.

---

## Компоненты (src/components)

### `components/auth/LoginForm.tsx`
- Форма входа: валидирует email и пароль с помощью `react-hook-form`.
- При сабмите диспатчит `loginUser` (Redux thunk).
- Отображает индикатор загрузки (`loading`) из `state.auth` и сообщение об ошибке из `state.auth.error`.

### `components/auth/RegisterForm.tsx`
- Форма регистрации: поля name, email, password, confirmPassword.
- Валидирует пароль и соответствие confirmPassword.
- При сабмите диспатчит `registerUser` (Redux thunk).
- Использует общий `loading` и `error` из `state.auth`.

### `components/layout/Layout.tsx`
- Глобальная обёртка приложения, инициализирует `loadUser` при монтировании (если не демо-пользователь).
- Отображает загрузочный экран, если `state.auth.loading` true.
- Инициализирует socketService при успешной аутентификации.

### `components/layout/Header.tsx`, `Sidebar.tsx`
- Навигационные компоненты, отображают меню в зависимости от роли пользователя.

---

## Redux (src/redux)

### `slices/authSlice.ts`
- Содержит состояние аутентификации: `user`, `token`, `isAuthenticated`, `loading`, `error`, `isTestUser`.
- Thunks:
  - `loginUser` — отправляет POST на `/api/auth/login`, сохраняет token в cookie и возвращает user/token.
  - `registerUser` — POST `/api/auth/register`, сохраняет token в cookie.
  - `loadUser` — пытается загрузить профиль по токену (использует `utils/api.ts`).
  - `updateProfile` — обновление профиля через `api.put('/auth/profile')`.
- Reducers: `logout`, `clearError`, `setTestUser`.

### `store.ts`
- Конфигурация Redux store и подключение слайсов.

---

## Утилиты и lib

### `src/utils/api.ts`
- Экземпляр axios с базовым URL из `NEXT_PUBLIC_API_URL`.
- Интерсепторы запросов/ответов: добавление `Authorization` заголовка и обработка 401 (удаление cookie и редирект на `/`).
- Экспортированные API-обёртки: `authAPI`, `dashboardAPI`, `adAPI`, `showAPI`, `userAPI`, `reportAPI`, `chatAPI`.

### `src/utils/socket.ts`
- Клиент socket.io (инициализация, подключение, подписки на комнаты/доски).

### `src/lib/database.ts`
- Обёртка для доступа к базе данных (используется в API-роутах). Методы: `getUserByEmail`, `createUser`, и т.д.

---

## Скрипты (scripts/)

### `scripts/init-db.js`
- Скрипт для применения схемы БД и создания начальных данных (вызов psql или подключение к БД напрямую).

### `scripts/quick-init.js`
- Вспомогательный скрипт для быстрого локального запуска (генерация .env, создание demo данных и т.д.).

---

## Как расширить этот документ

1. Я могу автоматически сгенерировать более подробный список, пройдя по всем файлам в `src/pages` и `src/components` и извлекая экспортируемые функции/компоненты и краткие описания.
2. Могу добавить раздел с диаграммой потоков аутентификации и примерами запросов/ответов (JSON).

---

Если согласны, я автоматически пройдусь по репозиторию и заполню этот файл функциями каждой страницы и ключевых скриптов (полный, покомпонентный список). Напишите, хотите ли вы автоматическое расширение сейчас.